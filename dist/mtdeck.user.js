// ==UserScript==
// @name        MTDeck
// @version     0.1.0
// @author      Compeito
// @description TweetDeckをモバイルで見やすくするUserScript
// @homepage    https://github.com/Compeito/mtdeck
// @match       https://tweetdeck.twitter.com
// @grant       GM_addStyle
// ==/UserScript==

!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e){!function(t,e){if("function"!=typeof t.createEvent)return!1;var n,o,r,i,u,s,a,c,d,l=function(t){var e=t.toLowerCase(),n="MS"+t;return navigator.msPointerEnabled?n:!!window.PointerEvent&&e},p=function(t){return"on"+t in window&&t},h={useJquery:!e.IGNORE_JQUERY&&"undefined"!=typeof jQuery,swipeThreshold:e.SWIPE_THRESHOLD||100,tapThreshold:e.TAP_THRESHOLD||150,dbltapThreshold:e.DBL_TAP_THRESHOLD||200,longtapThreshold:e.LONG_TAP_THRESHOLD||1e3,tapPrecision:e.TAP_PRECISION/2||30,justTouchEvents:e.JUST_ON_TOUCH_DEVICES},m=!1,f=p("touchstart")||l("PointerDown"),v=p("touchend")||l("PointerUp"),y=p("touchmove")||l("PointerMove"),w=function(t){return!t.pointerId||void 0===n||t.pointerId===n},g=function(t,e,n){for(var o=e.split(" "),r=o.length;r--;)t.addEventListener(o[r],n,!1)},b=function(t){return t.targetTouches?t.targetTouches[0]:t},T=function(t){return t.targetTouches&&t.targetTouches.length>1},E=function(){return(new Date).getTime()},x=function(e,n,i,u){var s=t.createEvent("Event");if(s.originalEvent=i,(u=u||{}).x=o,u.y=r,u.distance=u.distance,h.useJquery&&(s=jQuery.Event(n,{originalEvent:i}),jQuery(e).trigger(s,u)),s.initEvent){for(var a in u)s[a]=u[a];s.initEvent(n,!0,!0),e.dispatchEvent(s)}for(;e;)e["on"+n]&&e["on"+n](s),e=e.parentNode},I=0;g(t,f+(h.justTouchEvents?"":" mousedown"),(function(t){if(w(t)&&!T(t)&&(n=t.pointerId,"mousedown"!==t.type&&(m=!0),"mousedown"!==t.type||!m)){var e=b(t);i=o=e.pageX,u=r=e.pageY,d=setTimeout((function(){x(t.target,"longtap",t),a=t.target}),h.longtapThreshold),s=E(),I++}})),g(t,v+(h.justTouchEvents?"":" mouseup"),(function(t){if(w(t)&&!T(t))if(n=void 0,"mouseup"===t.type&&m)m=!1;else{var e=[],l=E(),p=u-r,f=i-o;if(clearTimeout(c),clearTimeout(d),f<=-h.swipeThreshold&&e.push("swiperight"),f>=h.swipeThreshold&&e.push("swipeleft"),p<=-h.swipeThreshold&&e.push("swipedown"),p>=h.swipeThreshold&&e.push("swipeup"),e.length){for(var v=0;v<e.length;v++){var y=e[v];x(t.target,y,t,{distance:{x:Math.abs(f),y:Math.abs(p)}})}I=0}else i>=o-h.tapPrecision&&i<=o+h.tapPrecision&&u>=r-h.tapPrecision&&u<=r+h.tapPrecision&&s+h.tapThreshold-l>=0&&(x(t.target,I>=2&&a===t.target?"dbltap":"tap",t),a=t.target),c=setTimeout((function(){I=0}),h.dbltapThreshold)}})),g(t,y+(h.justTouchEvents?"":" mousemove"),(function(t){if(w(t)&&("mousemove"!==t.type||!m)){var e=b(t);o=e.pageX,r=e.pageY}})),e.tocca=function(t){for(var e in t)h[e]=t[e];return h}}(document,window)},function(t,e,n){"use strict";n.r(e);n(0);var o={behavior:"smooth",block:"center",inline:"nearest"},r=function(){function t(){this.columnIndex=0,this.$columns=[]}return t.prototype.ready=function(){var t=this,e=setInterval((function(){t.$drawerButton=document.querySelector("button[data-drawer=compose]"),t.$drawerButton&&(t.init(),clearInterval(e))}),100)},t.prototype.update=function(){var t=this;this.$columns=[],document.querySelectorAll("section.column").forEach((function(e){t.$columns.push(e)})),this.fixColumnState()},t.prototype.fixColumnState=function(){this.columnIndex=0;for(var t=this.$columns[0],e=1;e<this.$columns.length;e++)Math.pow(this.$columns[e].getBoundingClientRect().left,2)<Math.pow(t.getBoundingClientRect().left,2)&&(t=this.$columns[e],this.columnIndex=e);t.scrollIntoView()},t.prototype.init=function(){var t=this;document.body.classList.add("mtdeck"),document.body.classList.add("mtdeck-close"),this.update(),document.body.addEventListener("touchmove",(function(t){return t.preventDefault()}),{passive:!1}),document.body.addEventListener("swipeleft",(function(e){return t.pushColumn()})),document.body.addEventListener("swiperight",(function(e){return t.backColumn()})),document.querySelector("div.app-columns-container").addEventListener("tap",(function(e){t.update(),t.closeDrawer()})),this.$drawerButton.addEventListener("tap",(function(e){t.closeDrawer()}))},t.prototype.pushColumn=function(){this.update(),this.closeDrawer(),this.columnIndex<this.$columns.length-1&&(this.columnIndex++,this.$columns[this.columnIndex].scrollIntoView(o))},t.prototype.backColumn=function(){this.update(),this.closeDrawer(),0==this.columnIndex?this.openDrawer():(this.columnIndex--,this.$columns[this.columnIndex].scrollIntoView(o))},Object.defineProperty(t.prototype,"hasDrawerOpen",{get:function(){return!document.body.classList.contains("mtdeck-close")},enumerable:!0,configurable:!0}),t.prototype.openDrawer=function(){this.hasDrawerOpen||document.body.classList.remove("mtdeck-close")},t.prototype.closeDrawer=function(){this.hasDrawerOpen&&document.body.classList.add("mtdeck-close")},t}();GM_addStyle("\n/* mtdeckに影響を受ける要素 */\nhtml, body.mtdeck {\n  overflow-x: hidden !important;\n}\nbody.mtdeck button[data-drawer=compose] {\n  z-index: 1;\n  position: fixed !important;\n  right: 0;\n  bottom: 0;\n  margin: 10px;\n  width: 4.5rem !important;\n  height: 4.5rem !important;\n}\nbody.mtdeck div.app-content {\n  left: 0 !important;\n}\nbody.mtdeck section.column {\n  width: 100% !important;\n}\n\n/* サイドバーの開閉 */\nbody.mtdeck-close header.app-header {\n  position: relative;\n  top: -50px\n}\nbody.mtdeck-close div.app-columns-container {\n  left: 0px !important;\n}\n\n/* ツイートドロワーの開閉 */\nbody.mtdeck div.app-content.is-open {\n  margin-right: 0 !important;\n  transform: translateX(100%) !important;\n}\nbody.mtdeck div.drawer[data-drawer=compose] {\n  left: -100%;\n  width: 100%;\n}\nbody.mtdeck button.js-hide-drawer {\n  display: none !important;\n}\n"),(new r).ready()}]);