// ==UserScript==
// @name        MTDeck
// @version     0.2.0
// @author      Compeito
// @description TweetDeckをモバイルで見やすくするUserScript
// @homepage    https://github.com/Compeito/mtdeck
// @match       https://tweetdeck.twitter.com
// @grant       GM_addStyle
// ==/UserScript==

!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){!function(e,t){if("function"!=typeof e.createEvent)return!1;var n,o,r,i,u,c,s,a,l,d=function(e){var t=e.toLowerCase(),n="MS"+e;return navigator.msPointerEnabled?n:!!window.PointerEvent&&t},p=function(e){return"on"+e in window&&e},h={useJquery:!t.IGNORE_JQUERY&&"undefined"!=typeof jQuery,swipeThreshold:t.SWIPE_THRESHOLD||100,tapThreshold:t.TAP_THRESHOLD||150,dbltapThreshold:t.DBL_TAP_THRESHOLD||200,longtapThreshold:t.LONG_TAP_THRESHOLD||1e3,tapPrecision:t.TAP_PRECISION/2||30,justTouchEvents:t.JUST_ON_TOUCH_DEVICES},m=!1,f=p("touchstart")||d("PointerDown"),y=p("touchend")||d("PointerUp"),v=p("touchmove")||d("PointerMove"),b=function(e){return!e.pointerId||void 0===n||e.pointerId===n},g=function(e,t,n){for(var o=t.split(" "),r=o.length;r--;)e.addEventListener(o[r],n,!1)},w=function(e){return e.targetTouches?e.targetTouches[0]:e},T=function(e){return e.targetTouches&&e.targetTouches.length>1},E=function(){return(new Date).getTime()},S=function(t,n,i,u){var c=e.createEvent("Event");if(c.originalEvent=i,(u=u||{}).x=o,u.y=r,u.distance=u.distance,h.useJquery&&(c=jQuery.Event(n,{originalEvent:i}),jQuery(t).trigger(c,u)),c.initEvent){for(var s in u)c[s]=u[s];c.initEvent(n,!0,!0),t.dispatchEvent(c)}for(;t;)t["on"+n]&&t["on"+n](c),t=t.parentNode},O=0;g(e,f+(h.justTouchEvents?"":" mousedown"),(function(e){if(b(e)&&!T(e)&&(n=e.pointerId,"mousedown"!==e.type&&(m=!0),"mousedown"!==e.type||!m)){var t=w(e);i=o=t.pageX,u=r=t.pageY,l=setTimeout((function(){S(e.target,"longtap",e),s=e.target}),h.longtapThreshold),c=E(),O++}})),g(e,y+(h.justTouchEvents?"":" mouseup"),(function(e){if(b(e)&&!T(e))if(n=void 0,"mouseup"===e.type&&m)m=!1;else{var t=[],d=E(),p=u-r,f=i-o;if(clearTimeout(a),clearTimeout(l),f<=-h.swipeThreshold&&t.push("swiperight"),f>=h.swipeThreshold&&t.push("swipeleft"),p<=-h.swipeThreshold&&t.push("swipedown"),p>=h.swipeThreshold&&t.push("swipeup"),t.length){for(var y=0;y<t.length;y++){var v=t[y];S(e.target,v,e,{distance:{x:Math.abs(f),y:Math.abs(p)}})}O=0}else i>=o-h.tapPrecision&&i<=o+h.tapPrecision&&u>=r-h.tapPrecision&&u<=r+h.tapPrecision&&c+h.tapThreshold-d>=0&&(S(e.target,O>=2&&s===e.target?"dbltap":"tap",e),s=e.target),a=setTimeout((function(){O=0}),h.dbltapThreshold)}})),g(e,v+(h.justTouchEvents?"":" mousemove"),(function(e){if(b(e)&&("mousemove"!==e.type||!m)){var t=w(e);o=t.pageX,r=t.pageY}})),t.tocca=function(e){for(var t in e)h[t]=e[t];return h}}(document,window)},function(e,t,n){"use strict";n.r(t);n(0);var o={behavior:"smooth",block:"center",inline:"nearest"},r=function(){function e(){this.columnIndex=0,this.$columns=[]}return e.prototype.ready=function(){var e=this,t=setInterval((function(){e.$drawerOpenButton=document.querySelector("button[data-drawer=compose]"),e.$drawerOpenButton&&(e.init(),clearInterval(t))}),100)},e.prototype.update=function(){var e=this;this.$columns=[],document.querySelectorAll("section.column").forEach((function(t){e.$columns.push(t)})),this.fixColumnState()},e.prototype.fixColumnState=function(){this.columnIndex=0;for(var e=this.$columns[0],t=1;t<this.$columns.length;t++)Math.pow(this.$columns[t].getBoundingClientRect().left,2)<Math.pow(e.getBoundingClientRect().left,2)&&(e=this.$columns[t],this.columnIndex=t);e.scrollIntoView()},e.prototype.init=function(){var e=this;document.body.classList.add("mtdeck"),document.body.classList.add("mtdeck-close"),this.update();var t=document.querySelector("div.app-columns-container");t.addEventListener("tap",(function(t){e.update(),e.closeMenu()})),t.addEventListener("swipeleft",(function(t){return e.pushColumn()})),t.addEventListener("swiperight",(function(t){return e.backColumn()})),history.pushState(null,null,null),window.addEventListener("popstate",(function(t){return e.back()})),this.$drawerOpenButton.addEventListener("tap",(function(t){e.closeMenu()}))},Object.defineProperty(e.prototype,"hasDetail",{get:function(){return document.querySelectorAll(".js-column-state-detail-view").length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasModal",{get:function(){return document.querySelectorAll(".js-modal-panel").length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDrawer",{get:function(){return document.querySelectorAll(".app-content.is-open").length>0},enumerable:!0,configurable:!0}),e.prototype.back=function(){this.hasDetail&&document.querySelectorAll(".js-column-back").forEach((function(e){e.click()}));this.hasModal&&document.querySelector(".js-dismiss").click();this.hasDrawer&&document.querySelector(".js-compose-close").click();history.pushState(null,null,null)},e.prototype.pushColumn=function(){this.update(),this.closeMenu(),this.columnIndex<this.$columns.length-1&&(this.columnIndex++,this.$columns[this.columnIndex].scrollIntoView(o))},e.prototype.backColumn=function(){this.update(),this.closeMenu(),0==this.columnIndex?this.openMenu():(this.columnIndex--,this.$columns[this.columnIndex].scrollIntoView(o))},Object.defineProperty(e.prototype,"hasMenuOpen",{get:function(){return!document.body.classList.contains("mtdeck-close")},enumerable:!0,configurable:!0}),e.prototype.openMenu=function(){this.hasMenuOpen||document.body.classList.remove("mtdeck-close")},e.prototype.closeMenu=function(){this.hasMenuOpen&&document.body.classList.add("mtdeck-close")},e}();GM_addStyle("\n/* mtdeckに影響を受ける要素 */\nbody.mtdeck button[data-drawer=compose] {\n  z-index: 1;\n  position: fixed !important;\n  right: 0;\n  bottom: 0;\n  margin: 10px;\n  width: 4.5rem !important;\n  height: 4.5rem !important;\n}\nbody.mtdeck div.app-content {\n  left: 0 !important;\n}\nbody.mtdeck div.app-columns-container {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\nbody.mtdeck section.column {\n  width: 100% !important;\n}\nbody.mtdeck .old-composer-footer {\n  display: none;\n}\n\n/* サイドバーの開閉 */\nbody.mtdeck-close header.app-header {\n  position: relative;\n  top: -50px\n}\nbody.mtdeck-close div.app-columns-container {\n  left: 0px !important;\n}\n\n/* ツイートドロワーの開閉 */\nbody.mtdeck div.app-content.is-open {\n  margin-right: 0 !important;\n  transform: translateX(100%) !important;\n}\nbody.mtdeck div.drawer[data-drawer=compose] {\n  left: -100%;\n  width: 100%;\n}\nbody.mtdeck button.js-hide-drawer {\n  display: none !important;\n}\n"),(new r).ready()}]);